<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../bower_components/paper-styles/color.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="lightning.html">

<dom-module id="youtube-dl">
  <template>
  <style include="shared-styles">
  :host {
    --app-primary-color: var(--paper-red-500);/*#4285f4;*/
    --app-secondary-color: var(--paper-deep-purple-500);

    display: block;
  }

  app-header {
    color: #fff;
    background-color: var(--app-primary-color);
  }
  app-header paper-icon-button {
    --paper-icon-button-ink-color: white;
  }

  paper-icon-button + [main-title] {
    margin-left: 24px;
  }

  .drawer-list a {
    display: block;
    padding: 0 16px;
    text-decoration: none;
    color: var(--app-secondary-color);
    line-height: 40px;
  }

  .drawer-list a.iron-selected {
    color: black;

    font-weight: bold;
  }

  paper-item.iron-selected:before {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    background: currentColor;
    content: '';
    opacity: 0.12;
    pointer-events: none;
  }

  .ytdl-fab-container {
    position: fixed;
    bottom: 25px;
    right: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  paper-fab {
    background-color: var(--app-secondary-color);
  }

  paper-fab.lightning {
    margin-bottom: 15px;
  }

  paper-tooltip #tooltip {
    line-height: 14px;
    font-size: 14px;
    padding: 16px;
  }
  </style>

  <app-location route="{{route}}"></app-location>
  <app-route
  route="{{route}}"
  pattern="/:page"
  data="{{routeData}}"
  tail="{{subroute}}"></app-route>

  <app-drawer-layout fullbleed>
    <!-- Drawer content -->
    <app-drawer>
      <paper-menu id="mainMenu" selected="[[page]]" attr-for-selected="name" class="drawer-list" role="navigation">
        <paper-item name="view1">View One</paper-item>
        <paper-item name="view2">View Two</paper-item>
        <paper-item name="view3">View Three</paper-item>
      </paper-menu>
    </app-drawer>

    <!-- Main content -->
    <app-header-layout has-scrolling-region>
      <app-header condenses fixed effects="waterfall">
        <app-toolbar>
          <paper-icon-button icon="menu" drawer-toggle></paper-icon-button>
          <div main-title>Youtube-dl GUI</div>
        </app-toolbar>
      </app-header>

      <iron-pages
      selected="[[page]]"
      attr-for-selected="name"
      fallback-selection="view404"
      role="main">
      <my-view1 name="view1"></my-view1>
      <my-view2 name="view2"></my-view2>
      <my-view3 name="view3"></my-view3>
      <my-view404 name="view404"></my-view404>
    </iron-pages>
  </app-header-layout>
</app-drawer-layout>
<!-- main fab -->
<div class="ytdl-fab-container">
  <paper-fab mini id="fabQuickDownload" class="lightning" icon="youtube-dl:lightning"></paper-fab>
  <paper-tooltip for="fabQuickDownload" position="left">Quick Download from a new URL</paper-tooltip>
  <paper-fab id="fabDownload" icon="add"></paper-fab>
  <paper-tooltip for="fabDownload" position="left">Download from a new URL</paper-tooltip>
</div>
</template>

<script>
Polymer({
  is: 'youtube-dl',

  properties: {
    page: {
      type: String,
      reflectToAttribute: true,
      observer: '_pageChanged'
    }
  },

  observers: [
    '_routePageChanged(routeData.page)'
  ],

  _routePageChanged: function(page) {
    this.page = page || 'view1';
  },

  _pageChanged: function(page) {
    // Load page import on demand. Show 404 page if fails
    var resolvedPageUrl = this.resolveUrl('my-' + page + '.html');
    this.importHref(resolvedPageUrl, null, this._showPage404, true);
  },

  _showPage404: function() {
    this.page = 'view404';
  },

  ready: function() {
    // attach event listeners on dom ready
    this.listen(this.$.mainMenu, 'tap', 'onMenuTap');
  },

  // handle tap events of all kinds and purposes
  onMenuTap: function(e) {
    // for main menu
    if (e.target.nodeName === 'PAPER-ITEM') {
      window.location.href = e.target.getAttribute('name');
    }
  },
});
</script>
</dom-module>
